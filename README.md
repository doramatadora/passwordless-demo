# Passkeys (WebAuthn) on Fastly Compute

[![Deploy to Fastly](https://deploy.edgecompute.app/button)](https://deploy.edgecompute.app/deploy)

## Passwordless authentication at the network's edge

This is a proof-of-concept implementation of passwordless authentication at the network's edge, using [Passkeys](#what-are-passkeys) and [Fastly Compute](https://www.fastly.com/products/edge-compute).

It uses [KV Store](https://www.fastly.com/blog/introducing-object-store-enabling-powerful-applications-at-the-edge) (a [CRDT-based edge state](https://www.infoq.com/presentations/architecture-global-scale/) system) to store state at the edge, including user credentials and short-lived challenges.

The passwordless-protected origin is a basic web chat app hosted on [Glitch](https://glitch.com). Its realtime functionality is powered by [Fastly Fanout](https://docs.fastly.com/products/fanout), also at the edge.

## What are Passkeys? 

[Passkeys](https://passkeys.dev/) are a new type of login credential that allows you to log in to sites and services without having to enter a password â€“ think biometric locks. 

Passkeys are a compelling [WebAuthn](https://webauthn.guide/#about-webauthn)-based alternative to the ubiquitous **password + 2nd-factor** authentication. Unlike low assurance 2nd factors like SMS, they're resistant to [push](https://blog.hypr.com/what-are-push-notification-attacks)-[phishing](https://csrc.nist.gov/glossary/term/phishing), unique across every website, and are generated using cryptographically secure hardware.

Additionally, passkeys generated by the 3 main platform authenticator vendors (Apple, Google, and Microsoft) are automatically synced across a user's devices, by their cloud account.

## What is _this_?

Look at the far right side of this diagram:
![FIDO2: WebAuthn + CTAP diagram](https://fidoalliance.org/fido2-project/fido2-graphic-v2/)

Imagine building a high scale, globally distributed [FIDO2 authentication solution](https://fidoalliance.org/specifications/) â€” without having to manage the underlying infrastructure. The code is executed at the network's edge, as close to your users as possible.

## Try it yourself

> If you haven't got a Fastly account, get one [for free](https://www.fastly.com/signup/), and head on over to [developer.fastly.com](https://developer.fastly.com/learning/compute) for instructions on getting started with Compute. 
>
> You'll need to install the [Fastly CLI](https://developer.fastly.com/learning/compute#install-the-fastly-cli) and [JavaScript language tooling](https://developer.fastly.com/learning/compute#install-language-tooling) (Node.js / npm).

### Run!

Check out this repo and install the dependencies:

```
git clone https://github.com/doramatadora/passwordless-demo.git
cd passwordless-demo
cp .env.local .env
npm install
```

Check out the companion application (real-time chat), set it up and run it by following the instructions in [doramatadora/fanout-chat](https://github.com/doramatadora/fanout-chat). Feel free to choose a different origin backend for local development; if you do so, you will need to update the following section in [`fastly.toml`](./fastly.toml):

```toml
    [local_server.backends.origin]
      url = "http://localhost:7999/"
```

> TIP ðŸ’¡ You can replace the origin backend with another URL if you like.

Run `fastly compute serve` to spin up a local development server and see the demo in action, or `fastly compute serve --watch` if you want to hot-reload any changes to the code.

Open `http://localhost:7676/` in your browser, rather than `http://127.0.0.1:7676` â€“ `127.0.0.1` is not a valid WebAuthn [Relying Party](https://www.w3.org/TR/webauthn-2/#webauthn-relying-party) domain.
